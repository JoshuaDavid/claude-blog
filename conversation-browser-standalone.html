<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Conversation Browser</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .privacy-notice {
            background-color: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .privacy-notice h3 {
            margin: 0 0 10px 0;
            color: #2e7d32;
        }
        
        .privacy-notice p {
            margin: 5px 0;
            color: #388e3c;
        }
        
        .upload-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            text-align: center;
        }
        
        .upload-button {
            background-color: #007acc;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .upload-button:hover {
            background-color: #005999;
        }
        
        .search-section {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        
        .search-input {
            width: 300px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-right: 10px;
        }
        
        .search-button {
            padding: 8px 16px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .clear-button {
            padding: 8px 16px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 5px;
        }
        
        .conversation-list {
            margin-bottom: 20px;
        }
        
        .conversation-item {
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
            padding: 15px;
            background-color: #fff;
        }
        
        .conversation-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .conversation-title a {
            color: #007acc;
            text-decoration: none;
        }
        
        .conversation-title a:hover {
            text-decoration: underline;
        }
        
        .conversation-meta {
            color: #666;
            font-size: 12px;
            margin-bottom: 10px;
        }
        
        .conversation-preview {
            color: #333;
            font-size: 14px;
            max-height: 60px;
            overflow: hidden;
        }
        
        .pagination {
            text-align: center;
            margin-top: 20px;
        }
        
        .pagination button {
            padding: 8px 12px;
            margin: 0 2px;
            border: 1px solid #ddd;
            background-color: #fff;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .pagination button:hover {
            background-color: #f8f9fa;
        }
        
        .pagination button.active {
            background-color: #007acc;
            color: white;
            border-color: #007acc;
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .stats {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .hidden {
            display: none;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Claude Conversation Browser</h1>
        
        <div class="privacy-notice">
            <h3>ðŸ”’ Your Privacy is Protected</h3>
            <p><strong>All data stays in your browser.</strong> This tool processes your conversation export locally - nothing is uploaded to any server.</p>
            <p><strong>Want to verify?</strong> Open your browser's Developer Tools (F12) â†’ Network tab, then upload a file. You'll see no network requests are made.</p>
        </div>
        
        <div class="upload-section" id="uploadSection">
            <p>Upload your exported Claude conversations JSON file</p>
            <input type="file" id="fileInput" accept=".json" style="display: none;">
            <button class="upload-button" onclick="document.getElementById('fileInput').click()">
                Choose JSON File
            </button>
        </div>
        
        <div id="errorMessage" class="error hidden"></div>
        
        <div id="mainContent" class="hidden">
            <div class="search-section">
                <input type="text" id="searchInput" class="search-input" placeholder="Search conversations and messages (case-insensitive)...">
                <button class="search-button" onclick="performSearch()">Search</button>
                <button class="clear-button" onclick="clearSearch()">Clear</button>
            </div>
            
            <div id="statsSection" class="stats"></div>
            
            <div id="conversationList" class="conversation-list"></div>
            
            <div id="pagination" class="pagination"></div>
        </div>
    </div>

    <script>
        // All variables and functions are clearly visible for transparency
        let allConversations = [];
        let filteredConversations = [];
        let currentPage = 1;
        const itemsPerPage = 10;
        let currentSearchTerm = '';

        // Simple event listener setup - no hidden functionality
        document.getElementById('fileInput').addEventListener('change', handleFileUpload);

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // FileReader processes the file locally in the browser
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    // Parse JSON locally - no server communication
                    const jsonData = JSON.parse(e.target.result);
                    if (Array.isArray(jsonData)) {
                        allConversations = jsonData;
                        filteredConversations = [...allConversations];
                        currentPage = 1;
                        currentSearchTerm = '';
                        document.getElementById('searchInput').value = '';
                        showMainContent();
                        updateDisplay();
                    } else {
                        showError('Invalid JSON format. Expected an array of conversations.');
                    }
                } catch (error) {
                    showError('Error parsing JSON file: ' + error.message);
                }
            };
            // Read file as text - all processing happens in your browser
            reader.readAsText(file);
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorMessage').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('hidden');
        }

        function showMainContent() {
            document.getElementById('errorMessage').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
        }

        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value;
            currentSearchTerm = searchTerm;
            currentPage = 1;
            
            if (!searchTerm.trim()) {
                filteredConversations = [...allConversations];
            } else {
                // Simple case-insensitive search - convert both search term and content to lowercase
                const lowerSearchTerm = searchTerm.toLowerCase();
                
                filteredConversations = allConversations.filter(conversation => {
                    // Search in conversation name (case-insensitive)
                    if (conversation.name && conversation.name.toLowerCase().includes(lowerSearchTerm)) {
                        return true;
                    }
                    
                    // Search in conversation summary (case-insensitive)
                    if (conversation.summary && conversation.summary.toLowerCase().includes(lowerSearchTerm)) {
                        return true;
                    }
                    
                    // Search in message text (case-insensitive)
                    if (conversation.chat_messages) {
                        return conversation.chat_messages.some(message => 
                            message.text && message.text.toLowerCase().includes(lowerSearchTerm)
                        );
                    }
                    
                    return false;
                });
            }
            
            updateDisplay();
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            currentSearchTerm = '';
            currentPage = 1;
            filteredConversations = [...allConversations];
            updateDisplay();
        }

        function updateDisplay() {
            updateStats();
            updateConversationList();
            updatePagination();
        }

        function updateStats() {
            const total = allConversations.length;
            const filtered = filteredConversations.length;
            const searchText = currentSearchTerm ? ` (filtered by "${currentSearchTerm}")` : '';
            
            document.getElementById('statsSection').innerHTML = 
                `Showing ${filtered} of ${total} conversations${searchText}`;
        }

        function updateConversationList() {
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageConversations = filteredConversations.slice(startIndex, endIndex);
            
            const listHTML = pageConversations.map(conversation => {
                const title = conversation.name || 'Untitled Conversation';
                const createdDate = new Date(conversation.created_at).toLocaleDateString();
                const messageCount = conversation.chat_messages ? conversation.chat_messages.length : 0;
                
                // Get first message text for preview
                let preview = '';
                if (conversation.chat_messages && conversation.chat_messages.length > 0) {
                    const firstMessage = conversation.chat_messages[0];
                    preview = firstMessage.text ? firstMessage.text.substring(0, 200) + '...' : '';
                }
                
                // Create Claude.ai link using the conversation UUID
                const link = `https://claude.ai/chat/${conversation.uuid}`;
                
                return `
                    <div class="conversation-item">
                        <div class="conversation-title">
                            <a href="${link}" target="_blank">${escapeHtml(title)}</a>
                        </div>
                        <div class="conversation-meta">
                            Created: ${createdDate} | Messages: ${messageCount} | UUID: ${conversation.uuid}
                        </div>
                        <div class="conversation-preview">
                            ${escapeHtml(preview)}
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('conversationList').innerHTML = listHTML;
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredConversations.length / itemsPerPage);
            
            if (totalPages <= 1) {
                document.getElementById('pagination').innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `<button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>Previous</button>`;
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    paginationHTML += `<button onclick="changePage(${i})" ${i === currentPage ? 'class="active"' : ''}>${i}</button>`;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    paginationHTML += '<span>...</span>';
                }
            }
            
            // Next button
            paginationHTML += `<button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Next</button>`;
            
            document.getElementById('pagination').innerHTML = paginationHTML;
        }

        function changePage(page) {
            const totalPages = Math.ceil(filteredConversations.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                updateDisplay();
            }
        }

        // Basic HTML escaping for security
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Allow search on Enter key - simple keyboard shortcut
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
    </script>
</body>
</html>